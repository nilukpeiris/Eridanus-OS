<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERIDANUS PILGRIM: SYSTEM STATUS</title>a
    
    <style>
        body {
            /* Main dashboard background color for the entire page */
            background-color: #0d1117; 
            color: #00ffaa; 
            font-family: 'Space Mono', monospace;
            padding: 0; 
            margin: 0;
            overflow-x: hidden;
        }

        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700;800&display=swap');
        
        /* --- LOADING SCREEN STYLES (Retained) --- */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0d1117; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #00ffaa; 
            font-size: 1.5em;
        }
        
        #loadingScreen p {
            margin-top: 20px;
            text-shadow: 0 0 5px #00ffaa;
        }

        /* SVG ANIMATION STYLES (Retained) */
        
        @keyframes bounce {
            0%,
            100% {
                translate: 0px 36px;
            }
            50% {
                translate: 0px 46px;
            }
        }
        @keyframes bounce2 {
            0%,
            100% {
                translate: 0px 46px;
            }
            50% {
                translate: 0px 56px;
            }
        }

        @keyframes umbral {
            0% {
                stop-color: #00ffaa2e;
            }
            50% {
                stop-color: rgba(0, 255, 170, 0.519);
            }
            100% {
                stop-color: #00ffaa2e;
            }
        }
        @keyframes partciles {
            0%,
            100% {
                translate: 0px 16px;
            }
            50% {
                translate: 0px 6px;
            }
        }
        
        #particles {
            animation: partciles 4s ease-in-out infinite;
        }
        #animatedStop {
            animation: umbral 4s infinite;
        }
        #bounce {
            animation: bounce 4s ease-in-out infinite;
            translate: 0px 36px;
        }
        #bounce2 {
            animation: bounce2 4s ease-in-out infinite;
            translate: 0px 46px;
            animation-delay: 0.5s;
        }
        
        /* --- DASHBOARD STYLES (3D AESTHETIC) --- */
        
        #dashboardContainer {
            padding: 25px;
            opacity: 0; 
            transition: opacity 0.5s;
            background-color: #0d1117; 
            min-height: 100vh;
        }
        
        .dashboard {
            width: 90%;
            max-width: 1000px;
            margin: auto;
            
            /* 3D Frame Effect: Layered borders and deep outer shadow */
            border: 2px solid #00ffaa;
            outline: 2px solid #00ffaa;
            outline-offset: 8px; 
            
            /* Deep, dark outer shadow (recessed look) and bright green inner glow (screen light) */
            box-shadow: 
                0 0 10px rgba(0, 255, 170, 0.5), 
                0 0 40px rgba(0, 0, 0, 0.8), 
                inset 0 0 15px rgba(0, 0, 0, 0.5); 
            
            background-color: #111a24; 
            padding: 20px;
            position: relative;
        }
        
        /* Geometric accents (Green Diamonds) - Enhanced with shadow */
        .dashboard::before, .dashboard::after {
            content: '';
            position: absolute;
            width: 15px; 
            height: 15px;
            background-color: #00ffaa;
            transform: rotate(45deg); 
            box-shadow: 0 0 10px #00ffaa, 0 0 20px #00ffaa;
            z-index: 10;
        }

        /* Top-left accent */
        .dashboard::before {
            top: -8px;
            left: -8px;
        }
        /* Bottom-right accent */
        .dashboard::after {
            bottom: -8px;
            right: -8px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px dashed #00ffaa;
            padding-bottom: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 0 0 8px #00ffaa;
        }

        .section {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        #systemStatus {
            border: 1px dashed #00ffaa;
            padding: 10px;
            margin-bottom: 25px;
            background-color: #0d1117; 
            box-shadow: inset 0 0 10px rgba(0, 255, 170, 0.1);
        }

        #controlMenu {
            border: 1px dashed #00ffaa;
            padding: 10px;
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 10px; 
            align-items: flex-start;
        }
        
        #controlMenu h2 {
            width: 100%;
            margin-bottom: 10px;
        }

        .status-box {
            background-color: #1a232e;
            border: 1px solid #00ffaa;
            padding: 15px;
            margin-bottom: 15px;
            width: 48%; 
            box-sizing: border-box;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.7), 0 0 5px rgba(0, 255, 170, 0.3);
        }

        .control-panel {
            min-width: 280px;
            height: auto; 
            overflow: visible; 

            margin-top: 10px;
            padding: 15px;
            border: 1px solid #00ffaa;
            background-color: #1a232e;
            box-sizing: border-box;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.9), 0 0 10px rgba(0, 255, 170, 0.4);
        }

        #navCorePanel {
            width: 100%;
        }
        
        #personnelPanel, #engineeringPanel {
            width: calc(50% - 5px);
            min-height: 250px; 
        }
        
        /* Geometric H3 Heading Accent - Enhanced with deep shadow */
        .control-panel h3 {
             color: #ffff00;
             margin-top: 0;
             margin-bottom: 15px;
             padding-left: 10px;
             border-left: 5px solid #00ffaa;
             position: relative;
             text-shadow: 0 0 5px #ffff00;
        }
        .control-panel h3::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%) rotate(45deg);
            width: 10px; 
            height: 10px;
            background-color: #00ffaa;
            box-shadow: 0 0 8px #00ffaa;
        }

        
        .control-panel button {
            background-color: #00ffaa;
            color: #0d1117;
            border: none;
            padding: 5px 10px; 
            font-family: 'Space Mono', monospace;
            cursor: pointer;
            transition: background-color 0.1s, box-shadow 0.1s;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.8em; 
            /* Button 3D look: outer glow and subtle inner recess */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5), inset 0 0 5px rgba(0, 0, 0, 0.2);
        }
        /* Depressed button effect on hover/active */
        .control-panel button:hover {
            background-color: #00cc88;
            /* Slightly darker on hover */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5), inset 0 0 10px #00ffaa;
            /* Looks pressed in */
        }
        .control-panel button:active {
            transform: translateY(1px);
        }


        .control-panel input {
            background-color: #000;
            color: #00ffaa;
            border: 1px solid #00ffaa;
            width: 90%; 
            box-sizing: border-box;
            margin-right: 5px;
            padding: 5px;
            /* Input 3D look: recessed */
            box-shadow: inset 0 0 10px rgba(0, 255, 170, 0.3), 0 0 5px rgba(0, 255, 170, 0.2);
        }
        
        .nav-input-group {
            display: block;
            margin-bottom: 5px;
        }
        .nav-input-group label {
            display: inline-block;
            width: 85px; 
            text-align: right; 
            margin-right: 5px;
        }
        .nav-input-group input {
            width: 55%;
            display: inline-block;
            box-sizing: border-box;
            padding: 3px; 
        }
        
        #navScanOutput {
            background-color: #000;
            border: 1px dashed #00ffaa;
            padding: 5px; 
            margin-bottom: 5px; 
            font-size: 0.75em; 
            white-space: pre;
            /* Recessed terminal look */
            box-shadow: inset 0 0 10px #00ffaa33;
        }

        #navClues {
            list-style: none;
            padding: 0;
            margin: 5px 0;
            font-size: 0.8em;
            border-top: 1px dashed #ffff00;
            padding-top: 5px;
            padding-bottom: 5px;
        }
        #navClues li {
            margin-bottom: 3px;
            color: #ffff00; 
        }

        #crewList {
            list-style: none;
            padding: 0;
            margin: 10px 0;
            display: flex; 
            flex-wrap: wrap;
            font-size: 0.9em;
        }
        #crewList li {
            width: 48%;
            margin-bottom: 5px;
            padding-right: 10px;
            box-sizing: border-box;
        }

        .terminal-output {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #00ffaa;
            padding: 10px;
            margin-top: 10px;
            background-color: #000;
            white-space: pre-wrap; 
            font-size: 0.95em;
            /* Deeply recessed terminal look */
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.9), 0 0 5px #00ffaa;
        }
        
        /* Status Classes */
        .critical { color: #ff0000;
            font-weight: bold; animation: pulse-crit 1s infinite alternate; }
        .nominal { color: #00ffaa;
        }
        .warning { color: #ffff00;
        }
        .offline { color: #888888;
        }
        
        @keyframes pulse-crit {
            from { text-shadow: 0 0 5px #ff0000;
            }
            to { text-shadow: 0 0 15px #ff0000;
            }
        }

        /* Gauge Styling */
        .gauge-bar {
            height: 15px;
            width: 100%;
            background-color: #333;
            margin-top: 5px;
            /* Recessed gauge track */
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .gauge-fill {
            height: 100%;
            transition: width 0.5s;
            /* Raised gauge fill */
            box-shadow: 0 0 5px rgba(0, 255, 170, 0.5);
        }

        /* --- MOBILE OPTIMIZATION (PERSONNEL ONLY) --- */
        @media (max-width: 768px) {
            
            /* Hide the main status monitor section */
            #systemStatus {
                display: none !important; 
            }
            
            /* Hide the main control menu heading */
            #controlMenu h2 {
                 display: none !important;
            }

            /* Hide the other control panels */
            #navCorePanel, 
            #engineeringPanel {
                display: none !important;
            }

            /* Make the personnel panel take up full width on mobile */
            #personnelPanel {
                width: 100% !important;
                min-height: auto; /* Reset min-height for mobile layout */
            }
            
            /* Reduce overall padding to maximize screen space */
             #dashboardContainer {
                padding: 10px;
            }
            .dashboard {
                width: 100%;
                padding: 10px;
                /* Remove geometric accents if they cause crowding */
                outline-offset: 4px; 
            }
        }
    </style>
</head>
<body>
    
    <div id="loadingScreen">
        <svg xmlns="http://www.w3.org/2000/svg" height="200" width="200">
            <g style="order: -1;">
                
                <polygon
                    transform="rotate(45 100 100)" 
                    stroke-width="1"
                    stroke="#00ffaa"
                    fill="none"
                    points="70,70 148,50 130,130 50,150"
                    id="bounce"
                ></polygon>
                <polygon
                    transform="rotate(45 100 100)" 
                    stroke-width="1"
                    stroke="#00ffaa"
                    fill="none"
                    points="70,70 148,50 130,130 50,150"
                    id="bounce2"
                ></polygon>
                
                <polygon
                    transform="rotate(45 100 100)"
                    stroke-width="2"
                    stroke=""
                    fill="#414750"
                    points="70,70 150,50 130,130 50,150"
                ></polygon>
                <polygon
                    stroke-width="2"
                    stroke=""
                    fill="url(#gradiente)"
                    points="100,70 150,100 100,130 50,100"
                ></polygon>
                <defs>
                    <linearGradient y2="100%" x2="10%" y1="0%" x1="0%" id="gradiente">
                        <stop style="stop-color: #1e2026;stop-opacity:1" offset="20%"></stop>
                        <stop style="stop-color:#414750;stop-opacity:1" offset="60%"></stop>
                    </linearGradient>
                </defs>
                <polygon
                    transform="translate(20, 31)"
                    stroke-width="2"
                    stroke=""
                    fill="#00cc88"
                    points="80,50 80,75 80,99 40,75"
                ></polygon>
                <polygon
                    transform="translate(20, 31)"
                    stroke-width="2"
                    stroke=""
                    fill="url(#gradiente2)"
                    points="40,-40 80,-40 80,99 40,75"
                ></polygon>
                <defs>
                    <linearGradient y2="100%" x2="0%" y1="-17%" x1="10%" id="gradiente2">
                        <stop style="stop-color: #00ffaa00;stop-opacity:1" offset="20%"></stop>
                        <stop
                            style="stop-color:#00ffaa54;stop-opacity:1"
                            offset="100%"
                            id="animatedStop"
                        ></stop>
                    </linearGradient>
                </defs>
                <polygon
                    transform="rotate(180 100 100) translate(20, 20)"
                    stroke-width="2"
                    stroke=""
                    fill="#00ffaa"
                    points="80,50 80,75 80,99 40,75"
                ></polygon>
                <polygon
                    transform="rotate(0 100 100) translate(60, 20)"
                    stroke-width="2"
                    stroke=""
                    fill="url(#gradiente3)"
                    points="40,-40 80,-40 80,85 40,110.2"
                ></polygon>
                <defs>
                    <linearGradient y2="100%" x2="10%" y1="0%" x1="0%" id="gradiente3">
                        <stop style="stop-color: #00ffaa00;stop-opacity:1" offset="20%"></stop>
                        <stop
                            style="stop-color:#00ffaa54;stop-opacity:1"
                            offset="100%"
                            id="animatedStop"
                        ></stop>
                    </linearGradient>
                </defs>
                <polygon
                    stroke-width="2"
                    stroke=""
                    fill="#292d34"
                    points="29.5,99.8 100,142 100,172 29.5,130"
                ></polygon>
                <polygon
                    transform="translate(50, 92)"
                    stroke-width="2"
                    stroke=""
                    fill="#1f2127"
                    points="50,50 120.5,8 120.5,35 50,80"
                ></polygon>
                
                <polygon
                    transform="rotate(45 100 100) translate(80, 95)"
                    stroke-width="2"
                    stroke=""
                    fill="#00ffaa"
                    points="5,0 5,5 0,5 0,0"
                    id="particles"
                ></polygon>
                <polygon
                    transform="rotate(45 100 100) translate(80, 55)"
                    stroke-width="2"
                    stroke=""
                    fill="#00cc88"
                    points="6,0 6,6 0,6 0,0"
                    id="particles"
                ></polygon>
                <polygon
                    transform="rotate(45 100 100) translate(70, 80)"
                    stroke-width="2"
                    stroke=""
                    fill="#00ffaa"
                    points="2,0 2,2 0,2 0,0"
                    id="particles"
                ></polygon>
            </g>
        </svg>
        <p>SYSTEM BOOT SEQUENCE INITIATED...</p>
    </div>
    
    <div id="dashboardContainer">
        <div class="dashboard">
            
            <div class="header">
                <h1>ERIDANUS PILGRIM</h1>
                <p>SYSTEM STATUS MONITOR // <span id="time"></span></p>
            </div>
            
            <div id="systemStatus">
                <h2><span style="color: #00ffaa;">[STATUS]</span> CRITICAL SYSTEMS MONITOR</h2>
                <div class="section">
                    <div class="status-box">
                        <h3>HULL INTEGRITY (FORE SECTION)</h3>
                        <p class="value" id="hullStatus"></p>
                    </div>
                    
                    <div class="status-box">
                        <h3>MAIN DRIVE ARRAY</h3>
                        <p class="value" id="engineStatus"></p>
                    </div>
                    
                    <div class="status-box">
                        <h3>LIFE SUPPORT: O2 LEVEL</h3>
                        <p><span class="value" id="o2Value"></span>%</p>
                        <div class="gauge-bar">
                            <div id="o2Gauge" class="gauge-fill"></div>
                        </div>
                    </div>

                    <div class="status-box">
                        <h3>EXTERNAL COMMUNICATIONS</h3>
                        <p class="value" id="commsStatus"></p>
                    </div>

                    <div class="status-box">
                        <h3>AUXILIARY POWER RESERVES</h3>
                        <p class="value" id="powerStatus"></p>
                    </div>

                    <div class="status-box">
                        <h3>CURRENT ASTROGATION COORDS</h3>
                        <p class="value" id="coordStatus"></p>
                    </div>
                </div>
            </div>
            
            <div id="controlMenu">
                <h2><span style="color: #ffff00;">[MENU]</span> ACCESS PANELS & CONTROLS</h2>
                
                <div class="control-panel" id="navCorePanel">
                    <h3>NAV CORE & ASTROGATION</h3>
                    
                    <p><strong>INITIAL NAVIGATIONAL SCAN:</strong></p>
                    <div id="navScanOutput">
                    </div>
                    
                    <p><strong>SYSTEM DEFRAG CLUES:</strong></p>
                    <ul id="navClues">
                        </ul>

                    <div id="navLogicPanel">
                        <p><strong>CONFIG RESET (2, 6, 10):</strong></p>
                        <div class="nav-input-group">
                            <label for="sector2">Sect 2:</label> <input type="text" id="sector2">
                        </div>
                        <div class="nav-input-group">
                            <label for="sector6">Sect 6:</label> <input type="text" id="sector6">
                        </div>
                        <div class="nav-input-group">
                            <label for="sector10">Sect 10:</label> <input type="text" id="sector10">
                        </div>
                        <button onclick="sectorLogicGame()">SUBMIT CONFIG</button>
                        <button onclick="clearLog()">CLEAR LOG</button>
                    </div>

                    <div id="navFinalPanel" style="display: none;">
                        <p><strong>DESTINATION VECTOR:</strong></p>
                        <input type="text" id="coordInput" placeholder="Enter 4-digit coordinate">
                        <button onclick="accessNav(document.getElementById('coordInput').value)">JUMP INITIATE</button>
                    </div>
            </div>

                <div class="control-panel" id="personnelPanel">
                    <h3>PERSONNEL FILE ACCESS (CREW)</h3>
                    <p><strong>CURRENT MANIFEST:</strong></p>
                    <ul id="crewList"></ul> 
                    
                    <input type="text" id="crewIdInput" placeholder="Enter Crew ID (1-12)"> 
                    <button onclick="getPersonnelFile(document.getElementById('crewIdInput').value)">
                        ACCESS CREW FILE
                    </button>
                    <button onclick="clearLog()">CLEAR LOG</button>
                </div>
                
                <div class="control-panel" id="engineeringPanel">
                    <h3>MAIN ENGINEERING ACCESS</h3>
                    <p><strong>ENGINE SYSTEM REPAIR:</strong></p>
                    <input type="text" id="engineCodeInput" placeholder="Engine Repair Code">
                    
                    <p><strong>HULL INTEGRITY REPAIR:</strong></p>
                    <input type="text" id="hullCodeInput" placeholder="Hull Repair Code">
                    
                    <button onclick="applyEngineeringFix()">APPLY REPAIR CODES</button>
                </div>
            </div>

            <div id="terminalLog" class="terminal-output">
                // SYSTEM LOG: Ready for command...
            </div>
        </div>
    </div>

    <script>
        
        // --- CORE GAME STATE & CONFIGURATION (Unchanged) ---
        const PASSWORD_MEDIC = "HEALTH4";
        const PASSWORD_HR = "HR99";
        const ENGINE_FIX_CODE = "FIXENGINESNOW"; 
        const HULL_FIX_CODE = "FIXHULLNOW";       
        const ERIDANI_COORDS = "4921";
        const EARTH_COORDS = "5067";
        // MODIFIED: New depletion rate for 75% drop in 3600 seconds (1 hour)
        const O2_DECAY_RATE = 0.020833;
        let shipData = {
            hull: { status: "SEAL BREACH - FORE SECTION EXTERNAL HULL", level: 50 },
            engine: { status: "CRITICAL FAILURE" },
            o2: { level: 75.0 }, 
            comms: { status: "OFFLINE" },
            power: { status: "STABLE (RESERVE)" },
            coords: { status: "NAV DATA CORRUPTED" }
        };
        const PLAYER_PROFILES = {
    	     1: {Role: "Captain", Expertise: "Leadership, Command", Record: "Fleet Captain C. P. Shepard, age 62, began their exemplary career by graduating at the top of their class from the Mars Naval Space Academy with a focus on Advanced Astrogation. Immediately following graduation, Shepard was recruited by the interplanetary conglomerate, ERIDANUS CORE, preferring the path of corporate logistics and deep-space resource acquisition over traditional military service. Shepardâ€™s ascent through the ranks was swift and steady, a testament to their exceptional command presence and unmatched operational efficiency. Their sustained high performance led to the prestigious command of a Pilgrim-class vessel, a position they have held for 30 consecutive years. This extensive tenure is underscored by an immaculate service record, entirely free of mission failures or disciplinary actions. Shepard embodies the ideal ERIDANUS CORE officer: highly competent, strategically brilliant, and unwaveringly dedicated to the corporation's expansion across the Eridani sector.", Status: "Active"},
            2: {Role: "Chief Engineer", Expertise: "Engine Systems, Power", Record: "MEDICAL ALERT: Diagnosed with Chronic Hypersleep Syndrome (Private File).", Status: "Active"},
            3: {Role: "Security Chief", Expertise: "Ship Layout, Codes", Record: "HIGH CLEARANCE: Corporate asset designation (Requires HR key).", Status: "Active"},
            4: {Role: "Lead Scientist", Expertise: "Life Support, Eridani Data", Record: "Research Data Criticality: Requires access to Security Chief's core.", Status: "Active"},
            5: {Role: "Pilot/Helmsman", Expertise: "Thrusters, Steering", Record: "Psych Evaluation: Moderate Space Crisis Phobia (Treated/Suppressed).", Status: "Active"},
            6: {Role: "Medical Officer", Expertise: "Biology, Personnel Records", Record: "Standard: Excellent service history. Recent research on Synthetic lifeforms.", Status: "Active"},
            7: {Role: "Xenolinguist", Expertise: "Communications, Translation", Record: "Unusual Comm Log: Detected a subtle external manipulation vector in early logs.", Status: "Active"},
            8: {Role: "Cybernetics Specialist", Expertise: "Hacking, AI interface", Record: "Internal Investigation Flag: Suspected of covering minor system sabotage (Confidential).", Status: "Active"},
            9: {Role: "Geologist/Miner", Expertise: "Hull Integrity, Materials", Record: "CRIMINAL RECORD FLAG: Wanted in Sector 3 for unauthorized data extraction.", Status: "Active"},
            10: {Role: "Janitor/Tech", Expertise: "Maintenance, Fuses", Record: "IDENTITY MASK: Technician Level 5. Disgraced but highly skilled (Use HR key for verification).", "Status": "Active"},
            11: {Role: "Unassigned", Expertise: "N/A", "Record": "Status Unknown. Cryo-pod 11 life signs flickering.", "Status": "Unknown"},
            12: {Role: "Unassigned", Expertise: "N/A", "Record": "Status Unknown. Cryo-pod 12 breach alarm triggered.", "Status": "Unknown"}
        };
        
        const SECTOR_SOLUTION = { 2: "COMET", 6: "GAS CLOUD", 10: "ERIDANI B" };
        const POSSIBLE_CONTENTS = [ "EARTH", "COMET x2", "GAS CLOUD x2", "ASTEROID x4", "EMPTY SPACE x2", "ERIDANI B" ];
        const SECTOR_SCAN_DATA = { 1: "CORRUPT", 2: "CORRUPT", 3: "NOT EARTH", 4: "NOT EARTH", 5: "CORRUPT", 6: "CORRUPT", 7: "NOT EARTH", 8: "NOT GAS CLOUD", 9: "CORRUPT", 10: "NOT ASTEROID", 11: "NOT GAS CLOUD", 12: "NOT GAS CLOUD" };
        const SECTOR_CLUES = [
            "DEFRAG 10%: SECTOR 11 COMET. EARTH is within 3 sectors of a COMET",
            "DEFRAG 20%: SECTOR 3 ASTEROID. EARTH is adjacent to an ASTEROID. ASTEROIDS are adjacent to at least ONE other ASTEROID",
            "DEFRAG 30%: SECTOR 12 ASTEROID. All ASTEROIDS are in a band of 6 sectors or less.",
            "DEFRAG 40%: SECTOR 9 GAS CLOUD. No GAS CLOUD is directly opposite of EARTH. GAS CLOUDS are adjacent to at least ONE EMPTY SPACE ",
            "DEFRAG 50%: SECTOR 8 EMPTY SPACE. No ASTEROID is adjacent to a GAS CLOUD.",
            "DEFRAG 60%: All GAS CLOUDS are in a band of 5 sectors or less",
            "DEFRAG 70%: ERIDANI B is within 2 sectors of an ASTEROID. ERIDANI B is NOT adjacent to EARTH",
        ];
        let currentClueIndex = -1; 
        let navUnlocked = false;
        let o2DepletionInterval; 
        let o2RecoveryInterval; 
        let o2RecoveryStarted = false; 

        // --- CORE LOGIC FUNCTIONS (Unchanged) ---
        const log = document.getElementById('terminalLog');
        
        function appendToLog(text) {
            log.innerHTML += text + '\n';
            log.scrollTop = log.scrollHeight; 
        }

        function clearLog() {
             log.innerHTML = '// SYSTEM LOG: Log Cleared.\n';
        }
        
        function writeToLog(text) {
            const logLines = log.innerHTML.split('\n');
            if (logLines.length > 0 && logLines[logLines.length - 1].endsWith('...')) {
                logLines.pop(); 
                log.innerHTML = logLines.join('\n');
            }
            
            log.innerHTML += text;
            log.scrollTop = log.scrollHeight;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function typeText(text, delay) {
            for (const char of text) {
                writeToLog(char);
                await sleep(delay * 1000); 
            }
            appendToLog('');
        }
        
        // --- ANIMATION FUNCTIONS (Unchanged) ---
        async function engineStartupAnimation() {
            clearLog();
            document.querySelectorAll('#engineeringPanel button').forEach(btn => btn.disabled = true);
            document.querySelectorAll('#engineeringPanel input').forEach(input => input.disabled = true);
            
            const separator = "=".repeat(60);
            appendToLog(separator);
            appendToLog(" MAIN DRIVE ARRAY ONLINE SEQUENCE INITIATED...");
            appendToLog(separator);

            await typeText("\n[STATUS: -100%] CALIBRATING PLASMA INJECTORS...", 0.05);
            await sleep(500);

            const framesInject = ["|", "/", "-", "\\"];
            await typeText("INJECTION SEQUENCE: ", 0.05);
            for (let i = 0; i < 25; i++) {
                const percentage = i * 5 + 2;
                const frame = framesInject[i % 4];
                const lastLineIndex = log.innerHTML.lastIndexOf('\n');
                const prevLog = lastLineIndex > 0 ? log.innerHTML.substring(0, lastLineIndex) : '';
                log.innerHTML = prevLog + `\n[${frame}] Injecting Flux Capacitor... ${percentage}%`;
                log.scrollTop = log.scrollHeight;
                await sleep(100);
            }
            
            const lastLineIndex = log.innerHTML.lastIndexOf('\n');
            const prevLog = lastLineIndex > 0 ? log.innerHTML.substring(0, lastLineIndex) : '';
            log.innerHTML = prevLog + "\n[OK] Plasma Injection Complete. ";
            log.scrollTop = log.scrollHeight;
            await sleep(500);

            await typeText("\n[STATUS: 0%] RE-ALIGNING DRIVE CORES (Critical Misalignment)....", 0.01);
            await sleep(500);
            
            for (let i = 1; i <= 3; i++) {
                const dots = ".".repeat(i);
                const lastLineIndex = log.innerHTML.lastIndexOf('\n');
                const prevLog = lastLineIndex > 0 ? log.innerHTML.substring(0, lastLineIndex) : '';
                log.innerHTML = prevLog + `\n[ALIGNMENT] Core ${i}: ${dots.padEnd(3)} Stabilizing`;
                log.scrollTop = log.scrollHeight;
                await sleep(500);
            }
            
            await typeText("\n[STATUS: 75%] CORE ALIGNMENT ACHIEVED.", 0.05);
            await sleep(1000);

            await typeText("\n[STATUS: 80%] IGNITION SEQUENCE...", 0.05);
            await typeText("...THRUSTERS ENGAGED. AUXILLARY POWER ENGAGED.", 0.05);
            writeToLog(">>>>> "); await sleep(200);
            writeToLog("ENERGY FIELD STABLE "); await sleep(300);
            appendToLog(">>>>>");
            await sleep(500);

            const hashSeparator = "#".repeat(60);
            appendToLog('\n' + hashSeparator);
            appendToLog(" ** MAIN DRIVE ARRAY: ONLINE **");
            appendToLog(" Power Level: 100%");
            appendToLog(hashSeparator);

            await sleep(1500);
            
            shipData.engine.status = "ONLINE / STANDBY";
            // Start O2 recovery after engine fix is confirmed
            startO2Recovery();
            document.getElementById('engineCodeInput').disabled = true;
            document.querySelectorAll('#engineeringPanel button').forEach(btn => btn.disabled = false);
            document.querySelectorAll('#engineeringPanel input').forEach(input => input.disabled = false);
            appendToLog("\n[SYSTEM LOG] Main Drive Array Online / Standby.");
            updateDashboard();
        }

        async function hullRepairAnimation() {
            clearLog();
            document.querySelectorAll('#engineeringPanel button').forEach(btn => btn.disabled = true);
            document.querySelectorAll('#engineeringPanel input').forEach(input => input.disabled = true);

            const separator = "=".repeat(60);
            appendToLog(separator);
            appendToLog(" HULL INTEGRITY PROTOCOL: INITIATED...");
            appendToLog(separator);

            await typeText("\n[STATUS: 0%] DIAGNOSING PRESSURE LOSS IN SECTOR 7...", 0.03);
            await sleep(500);

            await typeText("ISOLATING BREACH AREA...", 0.05);
            writeToLog("[ ]");
            await sleep(300);
            writeToLog("\r[<>]");
            await sleep(300);
            appendToLog("\r[<<>>] PRIMARY CONTAINMENT FIELD ACTIVE.");
            await sleep(500);

            await typeText("APPLYING EMERGENCY METALLIC PATCH...", 0.05);
            let progress_bar = "[" + " ".repeat(30) + "]";
            for (let i = 0; i < 30; i++) {
                progress_bar = progress_bar.substring(0, i + 1) + "#" + progress_bar.substring(i + 2);
                const lastLineIndex = log.innerHTML.lastIndexOf('\n');
                const prevLog = lastLineIndex > 0 ? log.innerHTML.substring(0, lastLineIndex) : '';
                log.innerHTML = prevLog + `\n[STATUS: 50% - 90%] Hardening Patch Material: ${progress_bar}`;
                log.scrollTop = log.scrollHeight;
                await sleep(80);
            }
            
            appendToLog("\r[STATUS: 90%] PATCH WELD COMPLETE. ");
            await sleep(500);

            await typeText("\n[STATUS: 95%] INITIATING PRESSURE RE-TEST...", 0.05);
            const pressure_levels = ["P: 10%... FAILED", "P: 30%... HOLDING", "P: 60%... HOLDING", "P: 100%... STABLE"];
            for (const level of pressure_levels) {
                const lastLineIndex = log.innerHTML.lastIndexOf('\n');
                const prevLog = lastLineIndex > 0 ? log.innerHTML.substring(0, lastLineIndex) : '';
                log.innerHTML = prevLog + `\n${level}`;
                log.scrollTop = log.scrollHeight;
                await sleep(500);
            }

            const starSeparator = "*".repeat(60);
            appendToLog('\n' + starSeparator);
            appendToLog(" ** HULL INTEGRITY: RESTORED **");
            appendToLog(" Pressure Seal: Nominal (100%)");
            appendToLog(starSeparator);

            await sleep(1500);

            shipData.hull.status = "SEALED / STABLE";
            document.getElementById('hullCodeInput').disabled = true;
            document.querySelectorAll('#engineeringPanel button').forEach(btn => btn.disabled = false);
            document.querySelectorAll('#engineeringPanel input').forEach(input => input.disabled = false);
            appendToLog("\n[SYSTEM LOG] Hull Integrity Restored. System Stable.");
            updateDashboard();
        }

        // --- UI STATUS UPDATE FUNCTIONS (Unchanged) ---
        function getStatusClass(statusText) {
            statusText = statusText.toUpperCase();
            if (statusText.includes("CRITICAL") || statusText.includes("FAILURE") || statusText.includes("CORRUPTED") || statusText.includes("BREACH")) {
                return "critical";
            } else if (statusText.includes("STABLE") || statusText.includes("NOMINAL") || statusText.includes("ONLINE") || statusText.includes("SEALED")) {
                return "nominal";
            } else if (statusText.includes("RESERVE") || statusText.includes("WARNING")) {
                return "warning";
            } else if (statusText.includes("OFFLINE") || statusText.includes("UNKNOWN")) {
                return "offline";
            }
            return "nominal";
        }

        let dashboardUpdateInterval;

        function updateDashboard() {
            document.getElementById('hullStatus').textContent = shipData.hull.status;
            document.getElementById('hullStatus').className = "value " + getStatusClass(shipData.hull.status);

            document.getElementById('engineStatus').textContent = shipData.engine.status;
            document.getElementById('engineStatus').className = "value " + getStatusClass(shipData.engine.status);

            document.getElementById('commsStatus').textContent = shipData.comms.status;
            document.getElementById('commsStatus').className = "value " + getStatusClass(shipData.comms.status);

            document.getElementById('powerStatus').textContent = shipData.power.status;
            document.getElementById('powerStatus').className = "value " + getStatusClass(shipData.power.status);

            document.getElementById('coordStatus').textContent = shipData.coords.status;
            document.getElementById('coordStatus').className = "value " + getStatusClass(shipData.coords.status);

            // O2 Gauge
            const o2Level = Math.max(0, Math.floor(shipData.o2.level)); // Clamp at 0
            document.getElementById('o2Value').textContent = o2Level.toFixed(1);
            const o2Gauge = document.getElementById('o2Gauge');
            o2Gauge.style.width = o2Level + '%';

            if (o2Level <= 25) {
                o2Gauge.style.backgroundColor = '#ff0000'; // Critical Red
                document.getElementById('o2Value').className = "value critical";
            } else if (o2Level <= 50) {
                o2Gauge.style.backgroundColor = '#ffff00'; // Warning Yellow
                document.getElementById('o2Value').className = "value warning";
            } else {
                o2Gauge.style.backgroundColor = '#00ffaa'; // Nominal Green
                document.getElementById('o2Value').className = "value nominal";
            }
            
            // Time update
            document.getElementById('time').textContent = new Date().toLocaleTimeString();
        }

        // --- O2 DEPLETION & RECOVERY LOGIC (Unchanged) ---
        function startO2Depletion() {
            if (o2RecoveryStarted) return; // Stop depletion if recovery is ongoing
            
            if (o2DepletionInterval) clearInterval(o2DepletionInterval); 

            o2DepletionInterval = setInterval(() => {
                // Decay rate is set to drop 75% in 3600 seconds (1 hour).
                // Per second decay: 75 / 3600 = 0.020833
                shipData.o2.level -= O2_DECAY_RATE; 
                if (shipData.o2.level < 0) {
                    shipData.o2.level = 0;
                    clearInterval(o2DepletionInterval);
                    appendToLog("\n[CRITICAL ERROR] OXYGEN DEPLETION. LIFE SUPPORT FAILURE.");
                    // Game Over condition could be implemented here
                }
            }, 1000); 
        }

        function startO2Recovery() {
            if (o2RecoveryStarted) return;
            o2RecoveryStarted = true;
            
            if (o2DepletionInterval) clearInterval(o2DepletionInterval);
            appendToLog("\n[INFO] O2 Generator activated. Beginning recovery sequence.");
            
            o2RecoveryInterval = setInterval(() => {
                shipData.o2.level += 0.5; // Recover 0.5% per second (fast recovery)
                if (shipData.o2.level >= 100) {
                    shipData.o2.level = 100;
                    clearInterval(o2RecoveryInterval);
                    o2RecoveryStarted = false;
                    appendToLog("\n[NOMINAL] O2 Level 100%. Life support stabilized.");
                }
            }, 1000);
        }

        // --- CREW LOGIC (Unchanged) ---
        function displayCrewList() {
            const crewList = document.getElementById('crewList');
            crewList.innerHTML = ''; // Clear previous list
            for (const id in PLAYER_PROFILES) {
                const profile = PLAYER_PROFILES[id];
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span style="color:#00ffaa;">[ID ${id}]</span> ${profile.Role} <span class="${getStatusClass(profile.Status)}">(${profile.Status})</span>`;
                crewList.appendChild(listItem);
            }
        }

        function getPersonnelFile(id) {
            id = parseInt(id.trim());
            const profile = PLAYER_PROFILES[id];
            
            if (!profile) {
                appendToLog(`\n[ERROR] Invalid Crew ID: ${id}. Range is 1-12.`);
                return;
            }
            
            clearLog();
            appendToLog("--- PERSONNEL FILE ACCESS ---");
            appendToLog(`ID: ${id}`);
            appendToLog(`ROLE: ${profile.Role}`);
            appendToLog(`EXPERTISE: ${profile.Expertise}`);
            appendToLog(`STATUS: <span class="${getStatusClass(profile.Status)}">${profile.Status}</span>`);
            appendToLog("-----------------------------");

            let recordText = profile.Record;

            // Check for special access requirements for private files
            if (recordText.includes("Private File")) {
                appendToLog(`\n[ACCESS DENIED] Restricted data detected. Enter key to decrypt:`);
                recordText = `<input type="text" id="medicKeyInput" placeholder="Medical Key"> <button onclick="attemptDecryption('medic', ${id})">DECRYPT</button>`;
            } else if (recordText.includes("HR key")) {
                appendToLog(`\n[ACCESS DENIED] High Clearance required. Enter key to decrypt:`);
                recordText = `<input type="text" id="hrKeyInput" placeholder="HR Key"> <button onclick="attemptDecryption('hr', ${id})">DECRYPT</button>`;
            }

            appendToLog(`RECORD: ${recordText}`);
        }

        function attemptDecryption(type, id) {
            const inputId = type === 'medic' ? 'medicKeyInput' : 'hrKeyInput';
            const key = document.getElementById(inputId).value.trim();
            const profile = PLAYER_PROFILES[id];

            // Replace the record entry with a success message/log
            const recordElement = log.querySelector('input[type="text"]').parentNode;

            if ((type === 'medic' && key.toUpperCase() === PASSWORD_MEDIC) || (type === 'hr' && key.toUpperCase() === PASSWORD_HR)) {
                // Successful decryption
                const fullRecord = getFullDecryptedRecord(id);
                recordElement.innerHTML = `RECORD: <span style="color:#ffff00;">[DECRYPT SUCCESS]</span> ${fullRecord}`;
                appendToLog(`\n[NOMINAL] Decryption successful. File ID ${id} unmasked.`);
            } else {
                // Failed decryption
                appendToLog(`\n[ERROR] Decryption key denied: ${key}. Access terminated.`);
            }
        }

        function getFullDecryptedRecord(id) {
            // Hardcoded full records for successful decryption
            switch (id) {
                case 2: return "Chief Engineer B. J. Hornsby. Decrypted Medical Record: The Chronic Hypersleep Syndrome is psychosomatic, triggered by extreme stress. Hornsby is lucid, but faking illness to avoid duty. The ship needs his expertise now.";
                case 3: return "Security Chief T. K. Valeriy. HIGH CLEARANCE: Corporate asset designation. Valeriy knows all door codes, including the Captain's quarters and the bridge command override, accessible via ID '8792'.";
                case 10: return "Janitor/Tech K. L. Zetta. IDENTITY MASK: Technician Level 5. Disgraced for selling classified blueprints, but his original field was NAV Core diagnostics. He knows the final Nav Code: **4921** (ERIDANI B).";
                default: return "Decryption successful, but no additional secret records found.";
            }
        }

        // --- NAV CORE LOGIC (Unchanged) ---
        function displaySectorScan() {
            const output = document.getElementById('navScanOutput');
            let scanText = "SCANNING SECTORS 1-12:\n";
            for (let i = 1; i <= 12; i++) {
                scanText += `[SECTOR ${String(i).padStart(2, '0')}] STATUS: ${SECTOR_SCAN_DATA[i] || 'UNKNOWN'}\n`;
            }
            output.textContent = scanText;
            
            // Initialize clues display
            document.getElementById('navClues').innerHTML = '';
            // Immediately show the first clue
            nextNavClue();
        }

        function nextNavClue() {
            if (currentClueIndex >= SECTOR_CLUES.length - 1) {
                appendToLog("\n[INFO] All Navigational Defrag clues displayed.");
                return;
            }
            currentClueIndex++;
            const clueText = SECTOR_CLUES[currentClueIndex];
            
            const clueList = document.getElementById('navClues');
            const listItem = document.createElement('li');
            listItem.textContent = clueText;
            clueList.appendChild(listItem);
        }

        function sectorLogicGame() {
            const s2 = document.getElementById('sector2').value.trim().toUpperCase();
            const s6 = document.getElementById('sector6').value.trim().toUpperCase();
            const s10 = document.getElementById('sector10').value.trim().toUpperCase();

            let correct = 0;
            if (s2 === SECTOR_SOLUTION[2]) correct++;
            if (s6 === SECTOR_SOLUTION[6]) correct++;
            if (s10 === SECTOR_SOLUTION[10]) correct++;

            clearLog();
            appendToLog("--- CONFIG RESET ATTEMPT ---");
            appendToLog(`INPUT: ${s2}, ${s6}, ${s10}`);
            appendToLog(`MATCHES: ${correct} / 3`);

            if (correct === 3) {
                appendToLog("\n[NOMINAL] NAV CONFIG RESET SUCCESSFUL.");
                appendToLog("Final destination vector panel is now unlocked. Coords Required.");
                document.getElementById('navLogicPanel').style.display = 'none';
                document.getElementById('navFinalPanel').style.display = 'block';
                document.getElementById('navCorePanel').style.boxShadow = '0 8px 15px rgba(0, 0, 0, 0.9), 0 0 20px #00ffaa'; // Add glow
                navUnlocked = true;
            } else {
                appendToLog(`\n[WARNING] Configuration incomplete. Defragging system...`);
                nextNavClue();
            }
        }

        async function accessNav(coord) {
            if (!navUnlocked) {
                appendToLog("\n[ACCESS DENIED] Navigational configuration incomplete. Complete the reset first.");
                return;
            }

            coord = coord.trim();
            clearLog();
            appendToLog("--- JUMP INITIATION PROTOCOL ---");
            appendToLog(`TARGET COORDINATE: ${coord}`);

            await sleep(500);

            if (coord === EARTH_COORDS) {
                appendToLog(`\n[ERROR] Coordinate ${coord} DENIED. Target vector is outside safe jump parameters.`);
                appendToLog("NAV SYSTEM: Redirecting to safe zone. ERIDANI B is mandatory destination.");
            } else if (coord === ERIDANI_COORDS) {
                appendToLog(`\n[NOMINAL] Coordinate ${coord} VERIFIED (ERIDANI B).`);
                await typeText("INITIATING JUMP SEQUENCE...", 0.05);
                await sleep(1000);
                
                // Final Success
                const successMsg = "\n** JUMP INITIATED: ERIDANUS CORE INCOMING **\nMISSION COMPLETE. WELCOME HOME, PILGRIM.";
                appendToLog(successMsg);
                shipData.coords.status = "ASTROGATION COMPLETE";
                shipData.comms.status = "ONLINE";
                updateDashboard();
            } else {
                appendToLog(`\n[ERROR] Coordinate ${coord} UNKNOWN or INVALID. Check data logs.`);
            }
        }
        
        // --- ENGINEERING LOGIC (Unchanged) ---
        let engineFixed = false;
        let hullFixed = false;

        function applyEngineeringFix() {
            const engineInputCode = document.getElementById('engineCodeInput').value.trim().toUpperCase();
            const hullInputCode = document.getElementById('hullCodeInput').value.trim().toUpperCase();
            let anyAction = false;

            clearLog();
            appendToLog("--- ENGINEERING REPAIR INITIATED ---");

            // Attempt Engine Fix
            if (engineInputCode === ENGINE_FIX_CODE && !engineFixed) {
                engineFixed = true;
                document.getElementById('engineCodeInput').disabled = true;
                engineStartupAnimation(); // Starts animation
                anyAction = true;
            } else if (engineInputCode && engineInputCode !== ENGINE_FIX_CODE && !engineFixed) {
                 appendToLog(`\n[ERROR] Engine Repair Code denied: ${engineInputCode}. Protocol violation.`);
            }

            // Attempt Hull Fix
            if (hullInputCode === HULL_FIX_CODE && !hullFixed) {
                hullFixed = true;
                document.getElementById('hullCodeInput').disabled = true;
                hullRepairAnimation(); // Starts animation
                anyAction = true;
            } else if (hullInputCode && hullInputCode !== HULL_FIX_CODE && !hullFixed) {
                 appendToLog(`\n[ERROR] Hull Repair Code denied: ${hullInputCode}. Protocol violation.`);
            }

            if (engineFixed && hullFixed) { 
                appendToLog("// SYSTEM LOG: Engines and Hull already repaired. No action taken."); 
            } else if (!anyAction) {
                appendToLog("\n[INFO] Please enter a valid code for the system you wish to repair.");
            }
        }
         
        // --- Initialization and Loading Screen Logic (Unchanged) ---

        function initializeDashboard() {
            // Wait 10 seconds, then hide the loading screen and show the dashboard
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                
                document.getElementById('dashboardContainer').style.opacity = '1';
                
                // Start the game logic only after the loading screen is gone
                displayCrewList(); 
                displaySectorScan(); 
                updateDashboard();
                // O2 depletion starts upon boot
                startO2Depletion(); 
                dashboardUpdateInterval = setInterval(updateDashboard, 1000); 

            }, 10000); // 10000 milliseconds = 10 seconds
        }

        window.onload = initializeDashboard;

    </script>
</body>
</html>